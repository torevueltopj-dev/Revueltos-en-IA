<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To' Revuelto's IA - Asistente MUN</title>
    <!-- Carga de Tailwind CSS para estilos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuración para usar la fuente Inter y colores personalizados -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            padding-top: 64px;
            padding-bottom: 80px;
        }
        .menu-button.active svg {
            transform: rotate(90deg);
        }
        .loading {
            display: none;
        }
        .result-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }
        .result-container.active {
            max-height: 1000px;
        }
        .mode-indicator {
            display: none;
        }
        .mode-indicator.active {
            display: block;
        }
    </style>
</head>
<body class="min-h-screen bg-white text-black">

    <!-- 1. ENCABEZADO FIJO (TOP) -->
    <header class="fixed top-0 left-0 w-full bg-white shadow-lg z-20">
        <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
            <!-- Logo e Identificador -->
            <div class="flex items-center space-x-3">
                <!-- Logo Placeholder -->
                <img 
                    src="https://placehold.co/40x40/007AFF/ffffff?text=Logo" 
                    alt="Logo To' Revuelto's IA" 
                    class="h-10 w-10 rounded-full object-cover"
                    onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgZmlsbD0ibm9uZSIgdmlld0JveD0iMCAwIDQwIDQwIj48Y2lyY2xlIGN4PSIyMCIgY3k9IjIwIiByPSIxOS41IiBmaWxsPSIjRjM2NTAwIi8+PHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTE2LjQ0MSAxOC41NDRsMS4yODktMS4yODktMy41MTUtMy41MThMOC42OTYgMjIuNjIybDcuNzQ1LTMuMDc4Wm0xMC41OTQgLjQxMmMtLjE5NS0uMjkzLS40NTgtLjU1Ni0uNzgxLS43MTktMS40NjgtLjY4Ny00Ljg0My0uNDItNS40OTktLjg3NS0uMDYyLS4wNjMtLjIxOC0uMjgxLS4wOTMtLjMyOGwtLjQzNy0uNTMxLS41NjIuNzgxYy0uMzQ0LjUzMS0uNTkxIDEuMDYyLS42NTYgMS40MDYtLjMyOCAxLjEwOS4xMjUgMi4xMjUtLjQzNyAzLjMzMi0uMjY1LjU3OC0uNTYyIDEuMTg4LS40MDYgMS43NS4xNTYgLjU2Mi4wOTQgMS4wNDctLjE1NiAxLjU2Mi0uMjUtLjU5My0uNDIxLTEuMzA5LS4xODctMS45NTMuMTg3LS41NDYuNTYyLTEuMDQ2IDEuMjAzLTEuMjUuNTkzLS4xODcgMS40ODQtLjY1NiAyLjM1OS0uMjUuOTY5LjQyMSAxLjczNSAuOTg0IDIuNDgzIDEuMjY1LjYyNS4yMiA1LjQyMSAxLjU5MyA2LjE1Ni0xLjMxMi4xODctLjMxMi4wNzgtLjYxMi0uMDYzLS44NzVMMTkuNjM0IDMxLjU0Yy4wNjMtLjE4Ny4wOTQtLjQzNy4wOTQtLjY1NlYyOS4yOWMtLjEyNS0uMTU2LS4yNS0uNDgzLS41My0uNzE5LS4yODEtLjIxOC0uNDIyLS40NjgtLjQyMS0uNzE5di0zLjg0NGMuMDMyLS4yNzkuMjQ0LS40OTYuNTE3LS41NTZ6TTE5LjYzNCAzNS44NDVjMS40MzYgMCAyLjU2Mi0xLjEyNSAyLjU2Mi0yLjUzMiAwLTEuNDM2LTEuMTI2LTIuNTYyLTIuNTYyLTIuNTYyLTEuNDM3IDAtMi41NjIgMS4xMjYtMi41NjIgMi41NjIgMCAxLjQzNyAxLjEyNSAyLjUzMiAyLjU2MiAyLjUzMloiLz48L3N2Zz4='"
                >
                <!-- Nombre de la App en Azul -->
                <h1 class="text-xl font-black text-blue-600 tracking-wide">
                    To' Revuelto's IA
                </h1>
            </div>

            <!-- Botón de Menú Redondo -->
            <button id="menuButton" 
                    class="menu-button p-3 rounded-full bg-blue-600 text-white shadow-xl transition-all duration-300 hover:bg-blue-700 active:scale-95" 
                    aria-label="Abrir menú de opciones">
                <!-- Icono de 3 puntos verticales -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 transition-transform duration-300">
                    <circle cx="12" cy="12" r="1"></circle>
                    <circle cx="12" cy="5" r="1"></circle>
                    <circle cx="12" cy="19" r="1"></circle>
                </svg>
            </button>
        </div>
    </header>

    <!-- Menú Desplegable (Inicialmente Oculto) -->
    <div id="dropdownMenu" 
         class="fixed top-16 right-4 z-30 w-64 bg-white rounded-xl shadow-2xl overflow-hidden transition-all duration-300 origin-top-right scale-0 opacity-0" 
         role="menu" 
         aria-orientation="vertical" 
         aria-labelledby="menuButton">
        <div class="p-2">
            <!-- Opciones del menú -->
            <button data-mode="search" class="w-full text-left px-4 py-3 text-sm text-black hover:bg-gray-100 rounded-lg transition-colors" role="menuitem">
                Búsqueda Diplomática
            </button>
            <button data-mode="interpellation" class="w-full text-left px-4 py-3 text-sm text-black hover:bg-gray-100 rounded-lg transition-colors" role="menuitem">
                Interpelación
            </button>
            <button data-mode="speech_correction" class="w-full text-left px-4 py-3 text-sm text-black hover:bg-gray-100 rounded-lg transition-colors" role="menuitem">
                Corrección de discursos
            </button>
            <button data-mode="topic_breakdown" class="w-full text-left px-4 py-3 text-sm text-black hover:bg-gray-100 rounded-lg transition-colors" role="menuitem">
                Desglose de tópico
            </button>
            <button data-mode="position_correction" class="w-full text-left px-4 py-3 text-sm text-black hover:bg-gray-100 rounded-lg transition-colors" role="menuitem">
                Corrección de Documento de posición
            </button>
        </div>
    </div>
    
    <!-- 2. CONTENIDO PRINCIPAL -->
    <main class="max-w-xl mx-auto p-4">
        <!-- Indicador de modo activo -->
        <div id="modeIndicator" class="mode-indicator mb-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
            <p class="text-blue-700 text-sm font-medium">
                <span id="currentModeText">Búsqueda Diplomática</span> activa
            </p>
        </div>

        <!-- Contenedor de resultados -->
        <div id="resultContainer" class="result-container bg-white rounded-xl shadow-sm border border-gray-200 p-4 mb-6">
            <div id="responseContent" class="text-gray-700"></div>
        </div>

        <!-- Mensaje de bienvenida -->
        <div id="welcomeMessage" class="text-center py-10">
            <p class="text-gray-500 text-lg">
                ¡Bienvenido a To' Revuelto's IA!
            </p>
            <p class="text-gray-400 mt-2">
                Usa la barra de búsqueda inferior para iniciar tu consulta o el menú superior derecho para acceder a las herramientas especializadas.
            </p>
        </div>

        <!-- Indicador de carga -->
        <div id="loadingIndicator" class="loading text-center py-8">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            <p class="text-gray-500 mt-2">Procesando tu solicitud...</p>
        </div>
    </main>

    <!-- 3. BARRA DE BÚSQUEDA FIJA (BOTTOM) -->
    <footer class="fixed bottom-0 left-0 w-full bg-white shadow-2xl z-20">
        <div class="max-w-7xl mx-auto p-4">
            <div class="flex items-center space-x-2">
                <!-- Barra de Búsqueda Redondeada -->
                <input type="text" 
                       id="searchInput"
                       placeholder="Escribe tu consulta aquí..." 
                       class="flex-grow p-3 border-2 border-gray-300 rounded-full focus:outline-none focus:border-blue-600 transition-colors text-black"
                       aria-label="Campo de entrada de búsqueda">

                <!-- Botón de Búsqueda Redondo (Chitón de búsqueda) -->
                <button id="searchButton" class="p-3 rounded-full bg-blue-600 text-white shadow-lg transition-colors duration-200 hover:bg-blue-700 active:scale-95" 
                        aria-label="Buscar">
                    <!-- Icono de Lupa -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </button>
            </div>
        </div>
    </footer>

    <!-- Lógica JavaScript para la aplicación -->
    <script>
        // Variables globales
        const API_KEY = 'AIzaSyArz0HOBHd8XB73KegLzG-NGxt5vbl-z0o';
        let currentMode = 'search'; // Modo por defecto

        document.addEventListener('DOMContentLoaded', () => {
            // Elementos DOM
            const menuButton = document.getElementById('menuButton');
            const dropdownMenu = document.getElementById('dropdownMenu');
            const searchButton = document.getElementById('searchButton');
            const searchInput = document.getElementById('searchInput');
            const modeIndicator = document.getElementById('modeIndicator');
            const currentModeText = document.getElementById('currentModeText');
            const resultContainer = document.getElementById('resultContainer');
            const responseContent = document.getElementById('responseContent');
            const welcomeMessage = document.getElementById('welcomeMessage');
            const loadingIndicator = document.getElementById('loadingIndicator');

            // Manejador del menú desplegable
            function toggleMenu() {
                const isHidden = dropdownMenu.classList.contains('scale-0');
                
                if (isHidden) {
                    dropdownMenu.classList.remove('scale-0', 'opacity-0');
                    dropdownMenu.classList.add('scale-100', 'opacity-100');
                    menuButton.classList.add('active');
                } else {
                    dropdownMenu.classList.remove('scale-100', 'opacity-100');
                    dropdownMenu.classList.add('scale-0', 'opacity-0');
                    menuButton.classList.remove('active');
                }
            }

            // Cambiar modo de la IA
            function setMode(mode) {
                currentMode = mode;
                
                // Actualizar texto del modo
                const modeTexts = {
                    'search': 'Búsqueda Diplomática',
                    'interpellation': 'Interpelación',
                    'speech_correction': 'Corrección de Discursos',
                    'topic_breakdown': 'Desglose de Tópico',
                    'position_correction': 'Corrección de Documento de Posición'
                };
                
                currentModeText.textContent = modeTexts[mode];
                modeIndicator.classList.add('active');
                
                // Actualizar placeholder según el modo
                const placeholders = {
                    'search': 'Escribe tu pregunta de investigación...',
                    'interpellation': 'Pega aquí el discurso para interpelar...',
                    'speech_correction': 'Pega aquí tu discurso para corregir...',
                    'topic_breakdown': 'Escribe el tópico que quieres desglosar...',
                    'position_correction': 'Pega aquí tu documento de posición...'
                };
                
                searchInput.placeholder = placeholders[mode];
            }

            // Procesar consulta con la API de Gemini
            async function processQuery(query) {
                // Mostrar indicador de carga
                loadingIndicator.style.display = 'block';
                welcomeMessage.style.display = 'none';
                resultContainer.classList.remove('active');
                
                try {
                    // Construir prompt según el modo
                    let prompt = '';
                    
                    switch(currentMode) {
                        case 'search':
                            prompt = `Busca información sobre "${query}" y proporciona enlaces relevantes de sitios .org, gubernamentales o de la ONU. Organiza la información por fecha, poniendo primero los más recientes. Para cada enlace, incluye un breve párrafo explicativo. Responde en español.`;
                            break;
                        case 'interpellation':
                            prompt = `Analiza críticamente el siguiente discurso: "${query}". Actúa como un delegado de un MUN y cuestiona cada parte del discurso. Responde en tercera persona usando frases como "La delegación de [país] se cuestiona..." o "Como [país] aborda...". Sé diplomático pero crítico. Responde en español.`;
                            break;
                        case 'speech_correction':
                            prompt = `Corrige el siguiente discurso MUN: "${query}". Analiza según la estructura: 1. Introducción (nivel mundial), 2. Desarrollo (nivel nacional), 3. Conclusión (propuestas internacionales). Proporciona correcciones específicas y sugerencias de mejora. Responde en español.`;
                            break;
                        case 'topic_breakdown':
                            prompt = `Desglosa el tópico "${query}" para un delegado MUN. Proporciona preguntas de investigación que debería responder para preparar su discurso o documento de posición. Incluye preguntas sobre antecedentes, situación actual, actores clave, desafíos y posibles soluciones. Responde en español.`;
                            break;
                        case 'position_correction':
                            prompt = `Corrige el siguiente documento de posición MUN: "${query}". Verifica que tenga la estructura adecuada (tópico, comisión, delegación, delegado), que cumpla con el rango de 500-800 palabras, y que incluya introducción (nivel mundial), desarrollo (nivel nacional) y conclusión (propuestas internacionales). Proporciona correcciones específicas. Responde en español.`;
                            break;
                    }
                    
                    // Llamada a la API de Gemini
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: prompt
                                }]
                            }]
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Error en la API: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    // Extraer texto de respuesta
                    const responseText = data.candidates[0].content.parts[0].text;
                    
                    // Mostrar resultados
                    responseContent.innerHTML = formatResponse(responseText);
                    resultContainer.classList.add('active');
                    
                } catch (error) {
                    console.error('Error:', error);
                    responseContent.innerHTML = `<p class="text-red-500">Error al procesar la solicitud: ${error.message}</p>`;
                    resultContainer.classList.add('active');
                } finally {
                    // Ocultar indicador de carga
                    loadingIndicator.style.display = 'none';
                }
            }
            
            // Formatear la respuesta según el modo
            function formatResponse(text) {
                let formattedText = text;
                
                // Aplicar formato según el modo
                switch(currentMode) {
                    case 'search':
                        // Resaltar enlaces y fechas
                        formattedText = formattedText.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" class="text-blue-600 underline" target="_blank">$1</a>');
                        formattedText = formattedText.replace(/(\d{1,2}\/\d{1,2}\/\d{4}|\d{4})/g, '<span class="font-semibold text-blue-700">$1</span>');
                        break;
                    case 'interpellation':
                        // Resaltar frases de cuestionamiento
                        formattedText = formattedText.replace(/(La delegación de [^ se cuestiona]+ se cuestiona)/g, '<span class="font-semibold text-red-600">$1</span>');
                        formattedText = formattedText.replace(/(Como [^ aborda]+ aborda)/g, '<span class="font-semibold text-red-600">$1</span>');
                        break;
                    case 'speech_correction':
                    case 'position_correction':
                        // Resaltar secciones y correcciones
                        formattedText = formattedText.replace(/(Introducción|Desarrollo|Conclusión|Bibliografía)/g, '<span class="font-bold text-blue-700">$1</span>');
                        formattedText = formattedText.replace(/(Corrección:|Sugerencia:|Mejora:)/g, '<span class="font-semibold text-green-600">$1</span>');
                        break;
                    case 'topic_breakdown':
                        // Resaltar preguntas
                        formattedText = formattedText.replace(/(\d+\.\s|•\s)/g, '<span class="font-semibold text-blue-600">$1</span>');
                        break;
                }
                
                // Mantener saltos de línea
                formattedText = formattedText.replace(/\n/g, '<br>');
                
                return formattedText;
            }

            // Event Listeners
            menuButton.addEventListener('click', (event) => {
                event.stopPropagation();
                toggleMenu();
            });

            // Cambiar modo al seleccionar una opción del menú
            dropdownMenu.querySelectorAll('button').forEach(option => {
                option.addEventListener('click', () => {
                    const mode = option.getAttribute('data-mode');
                    setMode(mode);
                    toggleMenu();
                });
            });

            // Ocultar menú al hacer clic fuera
            document.body.addEventListener('click', (event) => {
                if (!dropdownMenu.classList.contains('scale-0') && !menuButton.contains(event.target)) {
                    toggleMenu();
                }
            });

            // Procesar búsqueda al hacer clic en el botón
            searchButton.addEventListener('click', () => {
                const query = searchInput.value.trim();
                if (query) {
                    processQuery(query);
                }
            });

            // Procesar búsqueda al presionar Enter
            searchInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    const query = searchInput.value.trim();
                    if (query) {
                        processQuery(query);
                    }
                }
            });

            // Inicializar con modo de búsqueda
            setMode('search');
        });
    </script>

</body>
</html>