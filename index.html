<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To' Revuelto's IA - Asistente MUN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            padding-top: 64px;
            padding-bottom: 80px;
        }
        .menu-button.active svg {
            transform: rotate(90deg);
        }
        .loading {
            display: none;
        }
        .result-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }
        .result-container.active {
            max-height: 1000px;
        }
        .mode-indicator {
            display: none;
        }
        .mode-indicator.active {
            display: block;
        }
        .mode-button {
            transition: all 0.2s ease;
        }
        .mode-button.active {
            background-color: #3b82f6;
            color: white;
        }
    </style>
</head>
<body class="min-h-screen bg-white text-black">

    <!-- ENCABEZADO FIJO -->
    <header class="fixed top-0 left-0 w-full bg-white shadow-lg z-20">
        <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <img 
                    src="https://placehold.co/40x40/007AFF/ffffff?text=Logo" 
                    alt="Logo To' Revuelto's IA" 
                    class="h-10 w-10 rounded-full object-cover"
                >
                <h1 class="text-xl font-black text-blue-600 tracking-wide">
                    To' Revuelto's IA
                </h1>
            </div>

            <button id="menuButton" 
                    class="menu-button p-3 rounded-full bg-blue-600 text-white shadow-xl transition-all duration-300 hover:bg-blue-700 active:scale-95">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 transition-transform duration-300">
                    <circle cx="12" cy="12" r="1"></circle>
                    <circle cx="12" cy="5" r="1"></circle>
                    <circle cx="12" cy="19" r="1"></circle>
                </svg>
            </button>
        </div>
    </header>

    <!-- MEN√ö DESPLEGABLE -->
    <div id="dropdownMenu" 
         class="fixed top-16 right-4 z-30 w-64 bg-white rounded-xl shadow-2xl overflow-hidden transition-all duration-300 origin-top-right scale-0 opacity-0">
        <div class="p-2">
            <button data-mode="search" class="mode-button w-full text-left px-4 py-3 text-sm text-black hover:bg-gray-100 rounded-lg transition-colors">
                B√∫squeda Diplom√°tica
            </button>
            <button data-mode="interpellation" class="mode-button w-full text-left px-4 py-3 text-sm text-black hover:bg-gray-100 rounded-lg transition-colors">
                Interpelaci√≥n
            </button>
            <button data-mode="speech_correction" class="mode-button w-full text-left px-4 py-3 text-sm text-black hover:bg-gray-100 rounded-lg transition-colors">
                Correcci√≥n de discursos
            </button>
            <button data-mode="topic_breakdown" class="mode-button w-full text-left px-4 py-3 text-sm text-black hover:bg-gray-100 rounded-lg transition-colors">
                Desglose de t√≥pico
            </button>
            <button data-mode="position_correction" class="mode-button w-full text-left px-4 py-3 text-sm text-black hover:bg-gray-100 rounded-lg transition-colors">
                Correcci√≥n de Documento
            </button>
        </div>
    </div>
    
    <!-- CONTENIDO PRINCIPAL -->
    <main class="max-w-xl mx-auto p-4">
        <!-- Indicador de modo activo -->
        <div id="modeIndicator" class="mode-indicator mb-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
            <p class="text-blue-700 text-sm font-medium">
                <span id="currentModeText">B√∫squeda Diplom√°tica</span> activa
            </p>
        </div>

        <!-- Contenedor de resultados -->
        <div id="resultContainer" class="result-container bg-white rounded-xl shadow-sm border border-gray-200 p-4 mb-6">
            <div id="responseContent" class="text-gray-700"></div>
        </div>

        <!-- Mensaje de bienvenida -->
        <div id="welcomeMessage" class="text-center py-10">
            <p class="text-gray-500 text-lg">
                ¬°Bienvenido a To' Revuelto's IA!
            </p>
            <p class="text-gray-400 mt-2">
                Usa la barra de b√∫squeda inferior para iniciar tu consulta o el men√∫ superior derecho para acceder a las herramientas especializadas.
            </p>
        </div>

        <!-- Indicador de carga -->
        <div id="loadingIndicator" class="loading text-center py-8">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            <p class="text-gray-500 mt-2">Procesando tu solicitud...</p>
        </div>
    </main>

    <!-- BARRA DE B√öSQUEDA FIJA -->
    <footer class="fixed bottom-0 left-0 w-full bg-white shadow-2xl z-20">
        <div class="max-w-7xl mx-auto p-4">
            <div class="flex items-center space-x-2">
                <input type="text" 
                       id="searchInput"
                       placeholder="Escribe tu consulta aqu√≠..." 
                       class="flex-grow p-3 border-2 border-gray-300 rounded-full focus:outline-none focus:border-blue-600 transition-colors text-black">

                <button id="searchButton" class="p-3 rounded-full bg-blue-600 text-white shadow-lg transition-colors duration-200 hover:bg-blue-700 active:scale-95">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </button>
            </div>
        </div>
    </footer>

    <!-- L√≥gica JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Elementos DOM
            const menuButton = document.getElementById('menuButton');
            const dropdownMenu = document.getElementById('dropdownMenu');
            const searchButton = document.getElementById('searchButton');
            const searchInput = document.getElementById('searchInput');
            const modeIndicator = document.getElementById('modeIndicator');
            const currentModeText = document.getElementById('currentModeText');
            const resultContainer = document.getElementById('resultContainer');
            const responseContent = document.getElementById('responseContent');
            const welcomeMessage = document.getElementById('welcomeMessage');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const modeButtons = document.querySelectorAll('.mode-button');

            // Variables globales
            let currentMode = 'search';

            // Manejador del men√∫ desplegable
            function toggleMenu() {
                const isHidden = dropdownMenu.classList.contains('scale-0');
                
                if (isHidden) {
                    dropdownMenu.classList.remove('scale-0', 'opacity-0');
                    dropdownMenu.classList.add('scale-100', 'opacity-100');
                    menuButton.classList.add('active');
                } else {
                    dropdownMenu.classList.remove('scale-100', 'opacity-100');
                    dropdownMenu.classList.add('scale-0', 'opacity-0');
                    menuButton.classList.remove('active');
                }
            }

            // Cambiar modo de la IA
            function setMode(mode) {
                currentMode = mode;
                
                // Actualizar botones activos
                modeButtons.forEach(button => {
                    if (button.getAttribute('data-mode') === mode) {
                        button.classList.add('active');
                    } else {
                        button.classList.remove('active');
                    }
                });
                
                // Actualizar texto del modo
                const modeTexts = {
                    'search': 'B√∫squeda Diplom√°tica',
                    'interpellation': 'Interpelaci√≥n',
                    'speech_correction': 'Correcci√≥n de Discursos',
                    'topic_breakdown': 'Desglose de T√≥pico',
                    'position_correction': 'Correcci√≥n de Documento'
                };
                
                currentModeText.textContent = modeTexts[mode];
                modeIndicator.classList.add('active');
                
                // Actualizar placeholder seg√∫n el modo
                const placeholders = {
                    'search': 'Escribe tu pregunta de investigaci√≥n...',
                    'interpellation': 'Pega el discurso para interpelar...',
                    'speech_correction': 'Pega tu discurso para corregir...',
                    'topic_breakdown': 'Escribe el t√≥pico a desglosar...',
                    'position_correction': 'Pega tu documento de posici√≥n...'
                };
                
                searchInput.placeholder = placeholders[mode];
            }

            // Procesar consulta con la API de Gemini
            async function processQuery(query) {
                // Mostrar indicador de carga
                loadingIndicator.style.display = 'block';
                welcomeMessage.style.display = 'none';
                resultContainer.classList.remove('active');
                
                try {
                    // Construir prompt seg√∫n el modo (m√°s simples)
                    let prompt = '';
                    
                    switch(currentMode) {
                        case 'search':
                            prompt = `Busca: ${query}. Fuentes: ONU, gobierno, .org. Ordena por fecha. Responde en espa√±ol.`;
                            break;
                        case 'interpellation':
                            prompt = `Interpela: ${query}. Usa tercera persona. S√© cr√≠tico. Responde en espa√±ol.`;
                            break;
                        case 'speech_correction':
                            prompt = `Corrige: ${query}. Revisa estructura MUN. Responde en espa√±ol.`;
                            break;
                        case 'topic_breakdown':
                            prompt = `Desglosa: ${query}. Da preguntas para investigaci√≥n MUN. Responde en espa√±ol.`;
                            break;
                        case 'position_correction':
                            prompt = `Corrige documento: ${query}. Verifica estructura MUN. Responde en espa√±ol.`;
                            break;
                    }
                    
                    // Llamada a la API de Gemini
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=AIzaSyArz0HOBHd8XB73KegLzG-NGxt5vbl-z0o`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: prompt
                                }]
                            }]
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    // Extraer texto de respuesta
                    const responseText = data.candidates[0].content.parts[0].text;
                    
                    // Mostrar resultados
                    responseContent.innerHTML = formatResponse(responseText);
                    resultContainer.classList.add('active');
                    
                } catch (error) {
                    console.error('Error:', error);
                    
                    // Mostrar respuestas simuladas si la API falla
                    responseContent.innerHTML = generateFallbackResponse(currentMode, query);
                    resultContainer.classList.add('active');
                } finally {
                    // Ocultar indicador de carga
                    loadingIndicator.style.display = 'none';
                }
            }
            
            // Generar respuestas de respaldo si la API falla
            function generateFallbackResponse(mode, query) {
                const responses = {
                    'search': `
                        <h3 class="font-bold text-lg mb-3">Resultados para: "${query}"</h3>
                        <div class="space-y-4">
                            <div>
                                <a href="#" class="text-blue-600 font-medium">un.org/es</a>
                                <p class="mt-1">Informe de la ONU sobre ${query}.</p>
                            </div>
                            <div>
                                <a href="#" class="text-blue-600 font-medium">who.int/es</a>
                                <p class="mt-1">Datos de la OMS sobre ${query}.</p>
                            </div>
                        </div>
                    `,
                    'interpellation': `
                        <h3 class="font-bold text-lg mb-3">Interpelaci√≥n</h3>
                        <div class="space-y-3">
                            <p>La delegaci√≥n se cuestiona sobre ${query}.</p>
                            <p>¬øC√≥mo explica su posici√≥n?</p>
                        </div>
                    `,
                    'speech_correction': `
                        <h3 class="font-bold text-lg mb-3">Correcci√≥n</h3>
                        <div class="space-y-2">
                            <p><strong>Introducci√≥n:</strong> Bien contextualizada.</p>
                            <p><strong>Desarrollo:</strong> A√±ade datos nacionales.</p>
                            <p><strong>Conclusi√≥n:</strong> Propuestas claras.</p>
                        </div>
                    `,
                    'topic_breakdown': `
                        <h3 class="font-bold text-lg mb-3">Preguntas: "${query}"</h3>
                        <div class="space-y-2">
                            <p>‚Ä¢ Antecedentes del tema</p>
                            <p>‚Ä¢ Situaci√≥n actual</p>
                            <p>‚Ä¢ Posici√≥n de pa√≠ses</p>
                            <p>‚Ä¢ Soluciones posibles</p>
                        </div>
                    `,
                    'position_correction': `
                        <h3 class="font-bold text-lg mb-3">Correcci√≥n documento</h3>
                        <div class="space-y-2">
                            <p>‚úÖ Estructura correcta</p>
                            <p>‚ö†Ô∏è A√±ade m√°s datos</p>
                            <p>üìù Mejora propuestas</p>
                        </div>
                    `
                };
                
                return responses[mode] || `<p>Respuesta no disponible.</p>`;
            }
            
            // Formatear la respuesta
            function formatResponse(text) {
                let formattedText = text;
                
                // Resaltar elementos seg√∫n el modo
                switch(currentMode) {
                    case 'search':
                        formattedText = formattedText.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" class="text-blue-600 underline">$1</a>');
                        break;
                    case 'interpellation':
                        formattedText = formattedText.replace(/(La delegaci√≥n [^\.]+\.)/g, '<span class="text-red-600 font-medium">$1</span>');
                        break;
                }
                
                // Mantener saltos de l√≠nea
                formattedText = formattedText.replace(/\n/g, '<br>');
                
                return formattedText;
            }

            // Event Listeners
            menuButton.addEventListener('click', (event) => {
                event.stopPropagation();
                toggleMenu();
            });

            // Cambiar modo al seleccionar una opci√≥n del men√∫
            modeButtons.forEach(option => {
                option.addEventListener('click', () => {
                    const mode = option.getAttribute('data-mode');
                    setMode(mode);
                    toggleMenu();
                });
            });

            // Ocultar men√∫ al hacer clic fuera
            document.body.addEventListener('click', (event) => {
                if (!dropdownMenu.classList.contains('scale-0') && !menuButton.contains(event.target)) {
                    toggleMenu();
                }
            });

            // Procesar b√∫squeda
            searchButton.addEventListener('click', () => {
                const query = searchInput.value.trim();
                if (query) {
                    processQuery(query);
                }
            });

            // Procesar b√∫squeda al presionar Enter
            searchInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    const query = searchInput.value.trim();
                    if (query) {
                        processQuery(query);
                    }
                }
            });

            // Inicializar con modo de b√∫squeda
            setMode('search');
        });
    </script>

</body>
</html>