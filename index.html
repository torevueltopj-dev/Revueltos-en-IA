<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To' Revuelto's IA - Asistente MUN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            padding-top: 64px;
            padding-bottom: 80px;
        }
        .menu-button.active svg {
            transform: rotate(90deg);
        }
        .loading {
            display: none;
        }
        .result-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }
        .result-container.active {
            max-height: 1000px;
        }
        .mode-indicator {
            display: none;
        }
        .mode-indicator.active {
            display: block;
        }
        .mode-button {
            transition: all 0.2s ease;
        }
        .mode-button.active {
            background-color: #3b82f6;
            color: white;
        }
        .thinking-process {
            background: #f8fafc;
            border-left: 4px solid #3b82f6;
            padding: 12px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
        }
    </style>
</head>
<body class="min-h-screen bg-white text-black">

    <!-- ENCABEZADO FIJO -->
    <header class="fixed top-0 left-0 w-full bg-white shadow-lg z-20">
        <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <img src="https://placehold.co/40x40/007AFF/ffffff?text=Logo" alt="Logo" class="h-10 w-10 rounded-full">
                <h1 class="text-xl font-black text-blue-600 tracking-wide">
                    To' Revuelto's IA
                </h1>
            </div>

            <button id="menuButton" class="menu-button p-3 rounded-full bg-blue-600 text-white shadow-xl transition-all duration-300 hover:bg-blue-700">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 transition-transform duration-300">
                    <circle cx="12" cy="12" r="1"></circle>
                    <circle cx="12" cy="5" r="1"></circle>
                    <circle cx="12" cy="19" r="1"></circle>
                </svg>
            </button>
        </div>
    </header>

    <!-- MEN칔 DESPLEGABLE -->
    <div id="dropdownMenu" class="fixed top-16 right-4 z-30 w-64 bg-white rounded-xl shadow-2xl overflow-hidden transition-all duration-300 origin-top-right scale-0 opacity-0">
        <div class="p-2">
            <button data-mode="search" class="mode-button w-full text-left px-4 py-3 text-sm text-black hover:bg-gray-100 rounded-lg transition-colors">
                游댌 B칰squeda Diplom치tica
            </button>
            <button data-mode="interpellation" class="mode-button w-full text-left px-4 py-3 text-sm text-black hover:bg-gray-100 rounded-lg transition-colors">
                游눫 Interpelaci칩n
            </button>
            <button data-mode="speech_correction" class="mode-button w-full text-left px-4 py-3 text-sm text-black hover:bg-gray-100 rounded-lg transition-colors">
                游닇 Correcci칩n de discursos
            </button>
            <button data-mode="topic_breakdown" class="mode-button w-full text-left px-4 py-3 text-sm text-black hover:bg-gray-100 rounded-lg transition-colors">
                游꿢 Desglose de t칩pico
            </button>
            <button data-mode="position_correction" class="mode-button w-full text-left px-4 py-3 text-sm text-black hover:bg-gray-100 rounded-lg transition-colors">
                游늯 Correcci칩n de Documento
            </button>
        </div>
    </div>
    
    <!-- CONTENIDO PRINCIPAL -->
    <main class="max-w-xl mx-auto p-4">
        <!-- Indicador de modo activo -->
        <div id="modeIndicator" class="mode-indicator mb-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
            <p class="text-blue-700 text-sm font-medium">
                <span id="currentModeText">B칰squeda Diplom치tica</span> activa
            </p>
        </div>

        <!-- Proceso de pensamiento (Deep Thinking) -->
        <div id="thinkingProcess" class="thinking-process hidden mb-4">
            <p class="text-sm text-gray-600 font-medium">Procesando con DeepSeek...</p>
            <div id="thinkingSteps" class="text-xs text-gray-500 mt-2"></div>
        </div>

        <!-- Contenedor de resultados -->
        <div id="resultContainer" class="result-container bg-white rounded-xl shadow-sm border border-gray-200 p-4 mb-6">
            <div id="responseContent" class="text-gray-700"></div>
        </div>

        <!-- Mensaje de bienvenida -->
        <div id="welcomeMessage" class="text-center py-10">
            <p class="text-gray-500 text-lg">
                춰Bienvenido a To' Revuelto's IA!
            </p>
            <p class="text-gray-400 mt-2">
                Usa la barra de b칰squeda inferior para iniciar tu consulta.
            </p>
        </div>

        <!-- Indicador de carga -->
        <div id="loadingIndicator" class="loading text-center py-8">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            <p class="text-gray-500 mt-2">Procesando con DeepSeek...</p>
        </div>
    </main>

    <!-- BARRA DE B칔SQUEDA FIJA -->
    <footer class="fixed bottom-0 left-0 w-full bg-white shadow-2xl z-20">
        <div class="max-w-7xl mx-auto p-4">
            <div class="flex items-center space-x-2">
                <input type="text" 
                       id="searchInput"
                       placeholder="Escribe tu consulta aqu칤..." 
                       class="flex-grow p-3 border-2 border-gray-300 rounded-full focus:outline-none focus:border-blue-600 transition-colors text-black">

                <button id="searchButton" class="p-3 rounded-full bg-blue-600 text-white shadow-lg transition-colors duration-200 hover:bg-blue-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </button>
            </div>
        </div>
    </footer>

    <!-- L칩gica JavaScript para DeepSeek -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const menuButton = document.getElementById('menuButton');
            const dropdownMenu = document.getElementById('dropdownMenu');
            const searchButton = document.getElementById('searchButton');
            const searchInput = document.getElementById('searchInput');
            const modeIndicator = document.getElementById('modeIndicator');
            const currentModeText = document.getElementById('currentModeText');
            const resultContainer = document.getElementById('resultContainer');
            const responseContent = document.getElementById('responseContent');
            const welcomeMessage = document.getElementById('welcomeMessage');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const modeButtons = document.querySelectorAll('.mode-button');
            const thinkingProcess = document.getElementById('thinkingProcess');
            const thinkingSteps = document.getElementById('thinkingSteps');

            // API Key de DeepSeek
            const DEEPSEEK_API_KEY = 'sk-b3f2e2bc2dcd420a9ce681e5eba05e61';
            let currentMode = 'search';

            // Manejador del men칰 desplegable
            function toggleMenu() {
                const isHidden = dropdownMenu.classList.contains('scale-0');
                
                if (isHidden) {
                    dropdownMenu.classList.remove('scale-0', 'opacity-0');
                    dropdownMenu.classList.add('scale-100', 'opacity-100');
                    menuButton.classList.add('active');
                } else {
                    dropdownMenu.classList.remove('scale-100', 'opacity-100');
                    dropdownMenu.classList.add('scale-0', 'opacity-0');
                    menuButton.classList.remove('active');
                }
            }

            // Cambiar modo de la IA
            function setMode(mode) {
                currentMode = mode;
                
                // Actualizar botones activos
                modeButtons.forEach(button => {
                    if (button.getAttribute('data-mode') === mode) {
                        button.classList.add('active');
                    } else {
                        button.classList.remove('active');
                    }
                });
                
                // Actualizar texto del modo
                const modeTexts = {
                    'search': '游댌 B칰squeda Diplom치tica',
                    'interpellation': '游눫 Interpelaci칩n',
                    'speech_correction': '游닇 Correcci칩n de Discursos',
                    'topic_breakdown': '游꿢 Desglose de T칩pico',
                    'position_correction': '游늯 Correcci칩n de Documento'
                };
                
                currentModeText.textContent = modeTexts[mode];
                modeIndicator.classList.add('active');
                
                // Actualizar placeholder seg칰n el modo
                const placeholders = {
                    'search': 'Escribe tu pregunta de investigaci칩n...',
                    'interpellation': 'Pega el discurso para interpelar...',
                    'speech_correction': 'Pega tu discurso para corregir...',
                    'topic_breakdown': 'Escribe el t칩pico a desglosar...',
                    'position_correction': 'Pega tu documento de posici칩n...'
                };
                
                searchInput.placeholder = placeholders[mode];
            }

            // Mostrar proceso de pensamiento
            function showThinkingProcess(mode) {
                thinkingProcess.classList.remove('hidden');
                thinkingSteps.innerHTML = '';
                
                const thinkingMessages = {
                    'search': '游댌 Buscando informaci칩n diplom치tica relevante...',
                    'interpellation': '游눫 Analizando discurso para interpelaci칩n...',
                    'speech_correction': '游닇 Evaluando estructura del discurso MUN...',
                    'topic_breakdown': '游꿢 Desglosando t칩pico en preguntas de investigaci칩n...',
                    'position_correction': '游늯 Revisando documento de posici칩n...'
                };
                
                thinkingSteps.innerHTML = `<div class="mb-1">${thinkingMessages[mode]}</div>`;
            }

            // Procesar consulta con DeepSeek
            async function processQuery(query) {
                // Mostrar indicador de carga y proceso de pensamiento
                loadingIndicator.style.display = 'block';
                welcomeMessage.style.display = 'none';
                resultContainer.classList.remove('active');
                showThinkingProcess(currentMode);
                
                try {
                    // Construir prompt seg칰n el modo
                    let prompt = '';
                    
                    switch(currentMode) {
                        case 'search':
                            prompt = `Como asistente diplom치tico MUN, busca informaci칩n sobre: "${query}". Proporciona enlaces relevantes de sitios .org, gubernamentales o de la ONU. Organiza por fecha (m치s reciente primero). Para cada enlace, incluye un breve resumen. Responde en espa침ol.`;
                            break;
                        case 'interpellation':
                            prompt = `Como delegado MUN, analiza cr칤ticamente este discurso: "${query}". Cuestiona cada punto usando tercera persona ("La delegaci칩n de X se cuestiona..."). S칠 diplom치tico pero cr칤tico. Responde en espa침ol.`;
                            break;
                        case 'speech_correction':
                            prompt = `Corrige este discurso MUN: "${query}". Eval칰a: 1) Introducci칩n (nivel mundial), 2) Desarrollo (nivel nacional), 3) Conclusi칩n (propuestas internacionales). Da correcciones espec칤ficas. Responde en espa침ol.`;
                            break;
                        case 'topic_breakdown':
                            prompt = `Desglosa este t칩pico MUN: "${query}". Genera preguntas de investigaci칩n sobre: antecedentes, situaci칩n actual, actores clave, desaf칤os, soluciones. Responde en espa침ol.`;
                            break;
                        case 'position_correction':
                            prompt = `Corrige este documento de posici칩n MUN: "${query}". Verifica: estructura, formato (500-800 palabras), argumentaci칩n. Da correcciones espec칤ficas. Responde en espa침ol.`;
                            break;
                    }
                    
                    // Llamada a la API de DeepSeek
                    const response = await fetch('https://api.deepseek.com/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
                        },
                        body: JSON.stringify({
                            model: 'deepseek-chat',
                            messages: [
                                {
                                    role: 'user',
                                    content: prompt
                                }
                            ],
                            stream: false
                        })
                    });
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`Error ${response.status}: ${errorText}`);
                    }
                    
                    const data = await response.json();
                    
                    // Extraer texto de respuesta
                    const responseText = data.choices[0].message.content;
                    
                    // Mostrar resultados
                    responseContent.innerHTML = formatResponse(responseText, currentMode);
                    resultContainer.classList.add('active');
                    
                } catch (error) {
                    console.error('Error:', error);
                    responseContent.innerHTML = `
                        <div class="p-4 bg-red-50 rounded-lg border border-red-200">
                            <p class="text-red-700 font-medium">Error al procesar la solicitud</p>
                            <p class="text-red-600 text-sm mt-2">${error.message}</p>
                            <p class="text-red-600 text-sm mt-2">Intenta nuevamente o verifica tu conexi칩n.</p>
                        </div>
                    `;
                    resultContainer.classList.add('active');
                } finally {
                    // Ocultar indicadores
                    loadingIndicator.style.display = 'none';
                    thinkingProcess.classList.add('hidden');
                }
            }

            // Formatear la respuesta seg칰n el modo
            function formatResponse(text, mode) {
                let formattedText = text;
                
                // Aplicar formato seg칰n el modo
                switch(mode) {
                    case 'search':
                        // Resaltar enlaces
                        formattedText = formattedText.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" class="text-blue-600 underline font-medium" target="_blank">$1</a>');
                        // Resaltar fechas
                        formattedText = formattedText.replace(/(\d{1,2}\/\d{1,2}\/\d{4}|\d{4})/g, '<span class="bg-yellow-100 px-1 rounded">$1</span>');
                        break;
                    case 'interpellation':
                        // Resaltar frases de cuestionamiento
                        formattedText = formattedText.replace(/(La delegaci칩n de [^\.]+\.)/g, '<span class="text-red-600 font-medium bg-red-50 px-2 py-1 rounded">$1</span>');
                        formattedText = formattedText.replace(/(Como [^\?]+\?)/g, '<span class="text-blue-600 font-medium bg-blue-50 px-2 py-1 rounded">$1</span>');
                        break;
                    case 'speech_correction':
                    case 'position_correction':
                        // Resaltar secciones
                        formattedText = formattedText.replace(/(Introducci칩n|Desarrollo|Conclusi칩n|Bibliograf칤a)/g, '<span class="font-bold text-green-700">$1</span>');
                        formattedText = formattedText.replace(/(九|丘멆잺|游닇)/g, '<span class="text-lg">$1</span>');
                        break;
                }
                
                // Mantener saltos de l칤nea
                formattedText = formattedText.replace(/\n/g, '<br>');
                
                return formattedText;
            }

            // Event Listeners
            menuButton.addEventListener('click', (event) => {
                event.stopPropagation();
                toggleMenu();
            });

            modeButtons.forEach(option => {
                option.addEventListener('click', () => {
                    const mode = option.getAttribute('data-mode');
                    setMode(mode);
                    toggleMenu();
                });
            });

            document.body.addEventListener('click', (event) => {
                if (!dropdownMenu.classList.contains('scale-0') && !menuButton.contains(event.target)) {
                    toggleMenu();
                }
            });

            searchButton.addEventListener('click', () => {
                const query = searchInput.value.trim();
                if (query) {
                    processQuery(query);
                    searchInput.value = ''; // Limpiar input despu칠s de enviar
                }
            });

            searchInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    const query = searchInput.value.trim();
                    if (query) {
                        processQuery(query);
                        searchInput.value = ''; // Limpiar input despu칠s de enviar
                    }
                }
            });

            // Inicializar
            setMode('search');
        });
    </script>
</body>
</html>