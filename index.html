<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To' Revuelto's IA - Asistente MUN</title>
    <!-- Carga de Tailwind CSS para estilos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuraci√≥n para usar la fuente Inter y colores personalizados -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            padding-top: 64px;
            padding-bottom: 80px;
        }
        .menu-button.active svg {
            transform: rotate(90deg);
        }
        .loading {
            display: none;
        }
        .result-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }
        .result-container.active {
            max-height: 1000px;
        }
        .mode-indicator {
            display: none;
        }
        .mode-indicator.active {
            display: block;
        }
        .mode-button {
            transition: all 0.2s ease;
        }
        .mode-button.active {
            background-color: #3b82f6;
            color: white;
        }
    </style>
</head>
<body class="min-h-screen bg-white text-black">

    <!-- 1. ENCABEZADO FIJO (TOP) -->
    <header class="fixed top-0 left-0 w-full bg-white shadow-lg z-20">
        <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
            <!-- Logo e Identificador -->
            <div class="flex items-center space-x-3">
                <!-- Logo Placeholder -->
                <img 
                    src="https://placehold.co/40x40/007AFF/ffffff?text=Logo" 
                    alt="Logo To' Revuelto's IA" 
                    class="h-10 w-10 rounded-full object-cover"
                    onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgZmlsbD0ibm9uZSIgdmlld0JveD0iMCAwIDQwIDQwIj48Y2lyY2xlIGN4PSIyMCIgY3k9IjIwIiByPSIxOS41IiBmaWxsPSIjRjM2NTAwIi8+PHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTE2LjQ0MSAxOC41NDRsMS4yODktMS4yODktMy41MTUtMy41MThMOC42OTYgMjIuNjIybDcuNzQ1LTMuMDc4Wm0xMC41OTQgLjQxMmMtLjE5NS0uMjkzLS40NTgtLjU1Ni0uNzgxLS43MTktMS40NjgtLjY4Ny00Ljg0My0uNDItNS40OTktLjg3NS0uMDYyLS4wNjMtLjIxOC0uMjgxLS4wOTMtLjMyOGwtLjQzNy0uNTMxLS41NjIuNzgxYy0uMzQ0LjUzMS0uNTkxIDEuMDYyLS42NTYgMS40MDYtLjMyOCAxLjEwOS4xMjUgMi4xMjUtLjQzNyAzLjMzMi0uMjY1LjU3OC0uNTYyIDEuMTg4LS40MDYgMS43NS4xNTYgLjU2Mi4wOTQgMS4wNDctLjE1NiAxLjU2Mi0uMjUtLjU5My0uNDIxLTEuMzA5LS4xODctMS45NTMuMTg3LS41NDYuNTYyLTEuMDQ2IDEuMjAzLTEuMjUuNTkzLS4xODcgMS40ODQtLjY1NiAyLjM1OS0uMjUuOTY5LjQyMSAxLjczNSAuOTg0IDIuNDgzIDEuMjY1LjYyNS4yMiA1LjQyMSAxLjU5MyA2LjE1Ni0xLjMxMi4xODctLjMxMi4wNzgtLjYxMi0uMDYzLS44NzVMMTkuNjM0IDMxLjU0Yy4wNjMtLjE4Ny4wOTQtLjQzNy4wOTQtLjY1NlYyOS4yOWMtLjEyNS0uMTU2LS4yNS0uNDgzLS41My0uNzE5LS4yODEtLjIxOC0uNDIyLS40NjgtLjQyMS0uNzE5di0zLjg0NGMuMDMyLS4yNzkuMjQ0LS40OTYuNTE3LS41NTZ6TTE5LjYzNCAzNS44NDVjMS40MzYgMCAyLjU2Mi0xLjEyNSAyLjU2Mi0yLjUzMiAwLTEuNDM2LTEuMTI2LTIuNTYyLTIuNTYyLTIuNTYyLTEuNDM3IDAtMi41NjIgMS4xMjYtMi41NjIgMi41NjIgMCAxLjQzNyAxLjEyNSAyLjUzMiAyLjU2MiAyLjUzMloiLz48L3N2Zz4='"
                >
                <!-- Nombre de la App en Azul -->
                <h1 class="text-xl font-black text-blue-600 tracking-wide">
                    To' Revuelto's IA
                </h1>
            </div>

            <!-- Bot√≥n de Men√∫ Redondo -->
            <button id="menuButton" 
                    class="menu-button p-3 rounded-full bg-blue-600 text-white shadow-xl transition-all duration-300 hover:bg-blue-700 active:scale-95" 
                    aria-label="Abrir men√∫ de opciones">
                <!-- Icono de 3 puntos verticales -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 transition-transform duration-300">
                    <circle cx="12" cy="12" r="1"></circle>
                    <circle cx="12" cy="5" r="1"></circle>
                    <circle cx="12" cy="19" r="1"></circle>
                </svg>
            </button>
        </div>
    </header>

    <!-- Men√∫ Desplegable (Inicialmente Oculto) -->
    <div id="dropdownMenu" 
         class="fixed top-16 right-4 z-30 w-64 bg-white rounded-xl shadow-2xl overflow-hidden transition-all duration-300 origin-top-right scale-0 opacity-0" 
         role="menu" 
         aria-orientation="vertical" 
         aria-labelledby="menuButton">
        <div class="p-2">
            <!-- Opciones del men√∫ -->
            <button data-mode="search" class="mode-button w-full text-left px-4 py-3 text-sm text-black hover:bg-gray-100 rounded-lg transition-colors" role="menuitem">
                B√∫squeda Diplom√°tica
            </button>
            <button data-mode="interpellation" class="mode-button w-full text-left px-4 py-3 text-sm text-black hover:bg-gray-100 rounded-lg transition-colors" role="menuitem">
                Interpelaci√≥n
            </button>
            <button data-mode="speech_correction" class="mode-button w-full text-left px-4 py-3 text-sm text-black hover:bg-gray-100 rounded-lg transition-colors" role="menuitem">
                Correcci√≥n de discursos
            </button>
            <button data-mode="topic_breakdown" class="mode-button w-full text-left px-4 py-3 text-sm text-black hover:bg-gray-100 rounded-lg transition-colors" role="menuitem">
                Desglose de t√≥pico
            </button>
            <button data-mode="position_correction" class="mode-button w-full text-left px-4 py-3 text-sm text-black hover:bg-gray-100 rounded-lg transition-colors" role="menuitem">
                Correcci√≥n de Documento de posici√≥n
            </button>
        </div>
    </div>
    
    <!-- 2. CONTENIDO PRINCIPAL -->
    <main class="max-w-xl mx-auto p-4">
        <!-- Indicador de modo activo -->
        <div id="modeIndicator" class="mode-indicator mb-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
            <p class="text-blue-700 text-sm font-medium">
                <span id="currentModeText">B√∫squeda Diplom√°tica</span> activa
            </p>
        </div>

        <!-- Contenedor de resultados -->
        <div id="resultContainer" class="result-container bg-white rounded-xl shadow-sm border border-gray-200 p-4 mb-6">
            <div id="responseContent" class="text-gray-700"></div>
        </div>

        <!-- Mensaje de bienvenida -->
        <div id="welcomeMessage" class="text-center py-10">
            <p class="text-gray-500 text-lg">
                ¬°Bienvenido a To' Revuelto's IA!
            </p>
            <p class="text-gray-400 mt-2">
                Usa la barra de b√∫squeda inferior para iniciar tu consulta o el men√∫ superior derecho para acceder a las herramientas especializadas.
            </p>
        </div>

        <!-- Indicador de carga -->
        <div id="loadingIndicator" class="loading text-center py-8">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            <p class="text-gray-500 mt-2">Procesando tu solicitud...</p>
        </div>
    </main>

    <!-- 3. BARRA DE B√öSQUEDA FIJA (BOTTOM) -->
    <footer class="fixed bottom-0 left-0 w-full bg-white shadow-2xl z-20">
        <div class="max-w-7xl mx-auto p-4">
            <div class="flex items-center space-x-2">
                <!-- Barra de B√∫squeda Redondeada -->
                <input type="text" 
                       id="searchInput"
                       placeholder="Escribe tu consulta aqu√≠..." 
                       class="flex-grow p-3 border-2 border-gray-300 rounded-full focus:outline-none focus:border-blue-600 transition-colors text-black"
                       aria-label="Campo de entrada de b√∫squeda">

                <!-- Bot√≥n de B√∫squeda Redondo (Chit√≥n de b√∫squeda) -->
                <button id="searchButton" class="p-3 rounded-full bg-blue-600 text-white shadow-lg transition-colors duration-200 hover:bg-blue-700 active:scale-95" 
                        aria-label="Buscar">
                    <!-- Icono de Lupa -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </button>
            </div>
        </div>
    </footer>

    <!-- L√≥gica JavaScript para la aplicaci√≥n -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Elementos DOM
            const menuButton = document.getElementById('menuButton');
            const dropdownMenu = document.getElementById('dropdownMenu');
            const searchButton = document.getElementById('searchButton');
            const searchInput = document.getElementById('searchInput');
            const modeIndicator = document.getElementById('modeIndicator');
            const currentModeText = document.getElementById('currentModeText');
            const resultContainer = document.getElementById('resultContainer');
            const responseContent = document.getElementById('responseContent');
            const welcomeMessage = document.getElementById('welcomeMessage');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const modeButtons = document.querySelectorAll('.mode-button');

            // Variables globales
            let currentMode = 'search';

            // Manejador del men√∫ desplegable
            function toggleMenu() {
                const isHidden = dropdownMenu.classList.contains('scale-0');
                
                if (isHidden) {
                    dropdownMenu.classList.remove('scale-0', 'opacity-0');
                    dropdownMenu.classList.add('scale-100', 'opacity-100');
                    menuButton.classList.add('active');
                } else {
                    dropdownMenu.classList.remove('scale-100', 'opacity-100');
                    dropdownMenu.classList.add('scale-0', 'opacity-0');
                    menuButton.classList.remove('active');
                }
            }

            // Cambiar modo de la IA
            function setMode(mode) {
                currentMode = mode;
                
                // Actualizar botones activos
                modeButtons.forEach(button => {
                    if (button.getAttribute('data-mode') === mode) {
                        button.classList.add('active');
                    } else {
                        button.classList.remove('active');
                    }
                });
                
                // Actualizar texto del modo
                const modeTexts = {
                    'search': 'B√∫squeda Diplom√°tica',
                    'interpellation': 'Interpelaci√≥n',
                    'speech_correction': 'Correcci√≥n de Discursos',
                    'topic_breakdown': 'Desglose de T√≥pico',
                    'position_correction': 'Correcci√≥n de Documento de Posici√≥n'
                };
                
                currentModeText.textContent = modeTexts[mode];
                modeIndicator.classList.add('active');
                
                // Actualizar placeholder seg√∫n el modo
                const placeholders = {
                    'search': 'Escribe tu pregunta de investigaci√≥n...',
                    'interpellation': 'Pega aqu√≠ el discurso para interpelar...',
                    'speech_correction': 'Pega aqu√≠ tu discurso para corregir...',
                    'topic_breakdown': 'Escribe el t√≥pico que quieres desglosar...',
                    'position_correction': 'Pega aqu√≠ tu documento de posici√≥n...'
                };
                
                searchInput.placeholder = placeholders[mode];
            }

            // Procesar consulta con la API de Gemini
            async function processQuery(query) {
                // Mostrar indicador de carga
                loadingIndicator.style.display = 'block';
                welcomeMessage.style.display = 'none';
                resultContainer.classList.remove('active');
                
                try {
                    // Construir prompt seg√∫n el modo
                    let prompt = '';
                    
                    switch(currentMode) {
                        case 'search':
                            prompt = `Busca informaci√≥n sobre "${query}" y proporciona enlaces relevantes de sitios .org, gubernamentales o de la ONU. Organiza la informaci√≥n por fecha, poniendo primero los m√°s recientes. Para cada enlace, incluye un breve p√°rrafo explicativo. Responde en espa√±ol.`;
                            break;
                        case 'interpellation':
                            prompt = `Analiza cr√≠ticamente el siguiente discurso: "${query}". Act√∫a como un delegado de un MUN y cuestiona cada parte del discurso. Responde en tercera persona usando frases como "La delegaci√≥n de [pa√≠s] se cuestiona..." o "Como [pa√≠s] aborda...". S√© diplom√°tico pero cr√≠tico. Responde en espa√±ol.`;
                            break;
                        case 'speech_correction':
                            prompt = `Corrige el siguiente discurso MUN: "${query}". Analiza seg√∫n la estructura: 1. Introducci√≥n (nivel mundial), 2. Desarrollo (nivel nacional), 3. Conclusi√≥n (propuestas internacionales). Proporciona correcciones espec√≠ficas y sugerencias de mejora. Responde en espa√±ol.`;
                            break;
                        case 'topic_breakdown':
                            prompt = `Desglosa el t√≥pico "${query}" para un delegado MUN. Proporciona preguntas de investigaci√≥n que deber√≠a responder para preparar su discurso o documento de posici√≥n. Incluye preguntas sobre antecedentes, situaci√≥n actual, actores clave, desaf√≠os y posibles soluciones. Responde en espa√±ol.`;
                            break;
                        case 'position_correction':
                            prompt = `Corrige el siguiente documento de posici√≥n MUN: "${query}". Verifica que tenga la estructura adecuada (t√≥pico, comisi√≥n, delegaci√≥n, delegado), que cumpla con el rango de 500-800 palabras, y que incluya introducci√≥n (nivel mundial), desarrollo (nivel nacional) y conclusi√≥n (propuestas internacionales). Proporciona correcciones espec√≠ficas. Responde en espa√±ol.`;
                            break;
                    }
                    
                    // Llamada a la API de Gemini
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=AIzaSyArz0HOBHd8XB73KegLzG-NGxt5vbl-z0o`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: prompt
                                }]
                            }]
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Error en la API: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    // Extraer texto de respuesta
                    const responseText = data.candidates[0].content.parts[0].text;
                    
                    // Mostrar resultados
                    responseContent.innerHTML = formatResponse(responseText);
                    resultContainer.classList.add('active');
                    
                } catch (error) {
                    console.error('Error:', error);
                    
                    // Mostrar respuestas simuladas si la API falla
                    responseContent.innerHTML = generateFallbackResponse(currentMode, query);
                    resultContainer.classList.add('active');
                } finally {
                    // Ocultar indicador de carga
                    loadingIndicator.style.display = 'none';
                }
            }
            
            // Generar respuestas de respaldo si la API falla
            function generateFallbackResponse(mode, query) {
                const responses = {
                    'search': `
                        <h3 class="font-bold text-lg mb-3">Resultados de b√∫squeda para: "${query}"</h3>
                        <div class="space-y-4">
                            <div class="border-l-4 border-blue-500 pl-4">
                                <p class="text-sm text-gray-500">2024 - Informe m√°s reciente</p>
                                <a href="#" class="text-blue-600 font-medium">https://www.un.org/es/global-issues/${query.replace(/\s+/g, '-').toLowerCase()}</a>
                                <p class="mt-1">Informe actualizado de las Naciones Unidas sobre las tendencias globales relacionadas con ${query}.</p>
                            </div>
                            <div class="border-l-4 border-blue-400 pl-4">
                                <p class="text-sm text-gray-500">2023 - Documento gubernamental</p>
                                <a href="#" class="text-blue-600 font-medium">https://www.who.int/es/news-room/fact-sheets/detail/${query.replace(/\s+/g, '-').toLowerCase()}</a>
                                <p class="mt-1">La Organizaci√≥n Mundial de la Salud proporciona datos estad√≠sticos y recomendaciones sobre ${query}.</p>
                            </div>
                            <div class="border-l-4 border-blue-300 pl-4">
                                <p class="text-sm text-gray-500">2022 - Informe de ONG</p>
                                <a href="#" class="text-blue-600 font-medium">https://www.amnesty.org/es/latest/research/2022/05/${query.replace(/\s+/g, '-').toLowerCase()}/</a>
                                <p class="mt-1">Amnist√≠a Internacional documenta violaciones de derechos humanos relacionadas con ${query}.</p>
                            </div>
                        </div>
                    `,
                    'interpellation': `
                        <h3 class="font-bold text-lg mb-3">Interpelaci√≥n del discurso</h3>
                        <div class="space-y-3 bg-red-50 p-4 rounded-lg">
                            <p class="text-red-700 font-medium">La delegaci√≥n de M√©xico se cuestiona la afirmaci√≥n sobre...</p>
                            <p class="text-red-700">¬øC√≥mo explica la delegaci√≥n la contradicci√≥n entre su posici√≥n actual y sus compromisos previos en materia de ${query}?</p>
                            <p class="text-red-700">La delegaci√≥n de Francia solicita aclaraciones sobre las fuentes citadas en relaci√≥n con...</p>
                            <p class="text-red-700">Como Canad√° aborda las implicaciones presupuestarias de su propuesta?</p>
                            <p class="text-red-700">La delegaci√≥n de Brasil expresa preocupaci√≥n por la viabilidad t√©cnica de la soluci√≥n propuesta.</p>
                        </div>
                    `,
                    'speech_correction': `
                        <h3 class="font-bold text-lg mb-3">Correcci√≥n del discurso</h3>
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold text-blue-700">1. Introducci√≥n (Nivel mundial) - ‚úÖ Bien estructurada</h4>
                                <p class="text-sm text-gray-600 mt-1">Has contextualizado adecuadamente el problema a nivel global. Sugerencia: Incluye una estad√≠stica reciente de la ONU para fortalecer tu argumento.</p>
                            </div>
                            <div>
                                <h4 class="font-semibold text-blue-700">2. Desarrollo (Nivel nacional) - ‚ö†Ô∏è Necesita mejora</h4>
                                <p class="text-sm text-gray-600 mt-1">Falta mencionar programas espec√≠ficos implementados por tu pa√≠s. Ejemplo: "El programa Nacional de [pa√≠s] ha logrado..."</p>
                            </div>
                            <div>
                                <h4 class="font-semibold text-blue-700">3. Conclusi√≥n (Propuestas internacionales) - ‚úÖ Bien planteada</h4>
                                <p class="text-sm text-gray-600 mt-1">Tus propuestas son realistas y alineadas con los ODS. Considera a√±adir un mecanismo de financiaci√≥n concreto.</p>
                            </div>
                        </div>
                    `,
                    'topic_breakdown': `
                        <h3 class="font-bold text-lg mb-3">Preguntas de investigaci√≥n: "${query}"</h3>
                        <div class="space-y-3">
                            <p class="font-medium">Antecedentes hist√≥ricos:</p>
                            <ul class="list-disc pl-5 text-gray-600 space-y-1">
                                <li>¬øCu√°ndo surgi√≥ ${query} como problema internacional?</li>
                                <li>¬øQu√© resoluciones previas de la ONU existen sobre este tema?</li>
                            </ul>
                            
                            <p class="font-medium mt-3">Situaci√≥n actual:</p>
                            <ul class="list-disc pl-5 text-gray-600 space-y-1">
                                <li>¬øCu√°les son las estad√≠sticas m√°s recientes sobre ${query}?</li>
                                <li>¬øQu√© pa√≠ses son los m√°s afectados?</li>
                            </ul>
                            
                            <p class="font-medium mt-3">Actores clave:</p>
                            <ul class="list-disc pl-5 text-gray-600 space-y-1">
                                <li>¬øQu√© organismos internacionales trabajan en ${query}?</li>
                                <li>¬øQu√© pa√≠ses tienen posiciones l√≠deres en este tema?</li>
                            </ul>
                            
                            <p class="font-medium mt-3">Soluciones posibles:</p>
                            <ul class="list-disc pl-5 text-gray-600 space-y-1">
                                <li>¬øQu√© medidas han demostrado efectividad?</li>
                                <li>¬øQu√© recursos se necesitan para implementar soluciones?</li>
                            </ul>
                        </div>
                    `,
                    'position_correction': `
                        <h3 class="font-bold text-lg mb-3">Correcci√≥n del documento de posici√≥n</h3>
                        <div class="space-y-4">
                            <div class="p-3 bg-green-50 rounded-lg">
                                <h4 class="font-semibold text-green-700">‚úÖ Elementos correctos:</h4>
                                <ul class="list-disc pl-5 text-sm text-gray-600 mt-1">
                                    <li>Estructura general adecuada</li>
                                    <li>Uso correcto del lenguaje diplom√°tico</li>
                                    <li>Inclusi√≥n de referencias a resoluciones de la ONU</li>
                                </ul>
                            </div>
                            
                            <div class="p-3 bg-yellow-50 rounded-lg">
                                <h4 class="font-semibold text-yellow-700">‚ö†Ô∏è √Åreas de mejora:</h4>
                                <ul class="list-disc pl-5 text-sm text-gray-600 mt-1">
                                    <li>Falta mencionar programas nacionales espec√≠ficos</li>
                                    <li>Las propuestas internacionales necesitan mayor detalle</li>
                                    <li>Incluir m√°s datos estad√≠sticos recientes</li>
                                </ul>
                            </div>
                            
                            <div class="p-3 bg-blue-50 rounded-lg">
                                <h4 class="font-semibold text-blue-700">üìù Sugerencias:</h4>
                                <ul class="list-disc pl-5 text-sm text-gray-600 mt-1">
                                    <li>A√±adir 2-3 p√°rrafos sobre la posici√≥n hist√≥rica de tu pa√≠s</li>
                                    <li>Especificar mecanismos de implementaci√≥n para las propuestas</li>
                                    <li>Incluir al menos 3 fuentes bibliogr√°ficas adicionales</li>
                                </ul>
                            </div>
                        </div>
                    `
                };
                
                return responses[mode] || `<p>Respuesta no disponible para este modo.</p>`;
            }
            
            // Formatear la respuesta seg√∫n el modo
            function formatResponse(text) {
                let formattedText = text;
                
                // Aplicar formato seg√∫n el modo
                switch(currentMode) {
                    case 'search':
                        // Resaltar enlaces y fechas
                        formattedText = formattedText.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" class="text-blue-600 underline" target="_blank">$1</a>');
                        formattedText = formattedText.replace(/(\d{1,2}\/\d{1,2}\/\d{4}|\d{4})/g, '<span class="font-semibold text-blue-700">$1</span>');
                        break;
                    case 'interpellation':
                        // Resaltar frases de cuestionamiento
                        formattedText = formattedText.replace(/(La delegaci√≥n de [^ se cuestiona]+ se cuestiona)/g, '<span class="font-semibold text-red-600">$1</span>');
                        formattedText = formattedText.replace(/(Como [^ aborda]+ aborda)/g, '<span class="font-semibold text-red-600">$1</span>');
                        break;
                    case 'speech_correction':
                    case 'position_correction':
                        // Resaltar secciones y correcciones
                        formattedText = formattedText.replace(/(Introducci√≥n|Desarrollo|Conclusi√≥n|Bibliograf√≠a)/g, '<span class="font-bold text-blue-700">$1</span>');
                        formattedText = formattedText.replace(/(Correcci√≥n:|Sugerencia:|Mejora:)/g, '<span class="font-semibold text-green-600">$1</span>');
                        break;
                    case 'topic_breakdown':
                        // Resaltar preguntas
                        formattedText = formattedText.replace(/(\d+\.\s|‚Ä¢\s)/g, '<span class="font-semibold text-blue-600">$1</span>');
                        break;
                }
                
                // Mantener saltos de l√≠nea
                formattedText = formattedText.replace(/\n/g, '<br>');
                
                return formattedText;
            }

            // Event Listeners
            menuButton.addEventListener('click', (event) => {
                event.stopPropagation();
                toggleMenu();
            });

            // Cambiar modo al seleccionar una opci√≥n del men√∫
            modeButtons.forEach(option => {
                option.addEventListener('click', () => {
                    const mode = option.getAttribute('data-mode');
                    setMode(mode);
                    toggleMenu();
                });
            });

            // Ocultar men√∫ al hacer clic fuera
            document.body.addEventListener('click', (event) => {
                if (!dropdownMenu.classList.contains('scale-0') && !menuButton.contains(event.target)) {
                    toggleMenu();
                }
            });

            // Procesar b√∫squeda al hacer clic en el bot√≥n
            searchButton.addEventListener('click', () => {
                const query = searchInput.value.trim();
                if (query) {
                    processQuery(query);
                }
            });

            // Procesar b√∫squeda al presionar Enter
            searchInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    const query = searchInput.value.trim();
                    if (query) {
                        processQuery(query);
                    }
                }
            });

            // Inicializar con modo de b√∫squeda
            setMode('search');
        });
    </script>

</body>
</html>